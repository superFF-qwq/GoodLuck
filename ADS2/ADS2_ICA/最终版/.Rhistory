knitr::opts_chunk$set(echo = T, warning = F, message = F)
library(ggplot2)
library(dplyr)
library(tidyverse)
library(tidyr)
library(knitr)
substance_use = read.csv("substance_use.csv")
eap_alcohol_data = substance_use %>%
filter(measure == "Prevalence", cause == "Alcohol use disorders",
location == "East Asia & Pacific - WB") %>%
select(year, age, sex, val, lower, upper)
eap_alcohol_data1 = eap_alcohol_data
eap_alcohol_data1$age = paste0(eap_alcohol_data1$age, " years old")
ggplot(eap_alcohol_data1,
aes(x = year, y = val, color = sex,
group = interaction(sex, age))) +
geom_line() +
geom_errorbar(aes(ymin = lower, ymax = upper)) +
facet_wrap(~age, scales = 'free_y') +
labs(x = "Year", y = "Prevalence (%)", color = "Sex") +
theme_bw() +
theme(legend.position = "right",
plot.title = element_text(hjust = 0.5),
strip.background =  element_rect(fill = NA, colour = NA))
knitr::opts_chunk$set(echo = T, warning = F, message = F)
substance_use$location = as.factor(substance_use$location)
substance_use$sex = as.factor(substance_use$sex)
substance_use$age = as.factor(substance_use$age)
ggplot(data = substance_use,
aes(x = cause, y = val, color = interaction(cause, measure))) +
geom_boxplot(outlier.size = 0.1) +
facet_wrap(~location, scales = "free_y") +
labs(x = "Cause", y = "Value", color = "") +
theme_bw() +
theme(axis.text.x = element_blank(),
strip.text = element_text(size = 8),
strip.background =  element_rect(fill = NA, colour = NA),
legend.position = "bottom",
legend.key.size = unit(10, "pt"),
legend.text = element_text(size = 7),
legend.margin = margin(-10, 0, 0, -40))
highest_alcohol_deaths = substance_use %>%
filter(measure == "Deaths", year == 2019, age == "40 to 44",
sex == "Male", cause == "Alcohol use disorders") %>%
select(location, val) %>%
arrange(desc(val)) %>%
top_n(1, val)
kable(highest_alcohol_deaths)
eap_alcohol_data = substance_use %>%
filter(measure == "Prevalence", cause == "Alcohol use disorders",
location == "East Asia & Pacific - WB") %>%
select(year, age, sex, val, lower, upper)
eap_alcohol_data1 = eap_alcohol_data
eap_alcohol_data1$age = paste0(eap_alcohol_data1$age, " years old")
ggplot(eap_alcohol_data1,
aes(x = year, y = val, color = sex,
group = interaction(sex, age))) +
geom_line() +
geom_errorbar(aes(ymin = lower, ymax = upper)) +
facet_wrap(~age, scales = 'free_y') +
labs(x = "Year", y = "Prevalence (%)", color = "Sex") +
theme_bw() +
theme(legend.position = "right",
plot.title = element_text(hjust = 0.5),
strip.background =  element_rect(fill = NA, colour = NA))
ggplot(eap_alcohol_data,
aes(x = year, y = val, color = age,
group = interaction(sex, age))) +
geom_line() +
geom_point(size = 0.6) +
facet_wrap(~sex, scales = 'free_y') +
labs(x = "Year", y = "Prevalence (%)", color = "Age (years old)") +
theme_bw() +
theme(legend.title = element_text(hjust = 0.5),
plot.title = element_text(hjust = 0.5),
strip.background =  element_rect(fill = NA, colour = NA))
eap_alcohol_data2 = eap_alcohol_data %>%
group_by(age) %>%
group_split() %>%
map(~spread(., key = "sex", value = "val")) %>%
map(~{
shapiro_p = shapiro.test(.$Male - .$Female)$p.value
if(shapiro_p < 0.05){
test_type = "Wilcoxon rank sum test"
p_value = wilcox.test(.$Male, .$Female, paired = T)$p.value
}
else{
test_type = "Student's t-test"
p_value = t.test(.$Male, .$Female, paired = T)$p.value
}
tibble(shapiro_p = shapiro_p, test_type = test_type, p_value = p_value)
}) %>%
bind_rows() %>%
mutate(age = unique(eap_alcohol_data$age), .before = shapiro_p)
eap_alcohol_data2 = eap_alcohol_data %>%
select(year, age, sex, val)
group_by(age) %>%
group_split() %>%
map(~spread(., key = "sex", value = "val")) %>%
map(~{
shapiro_p = shapiro.test(.$Male - .$Female)$p.value
if(shapiro_p < 0.05){
test_type = "Wilcoxon rank sum test"
p_value = wilcox.test(.$Male, .$Female, paired = T)$p.value
}
else{
test_type = "Student's t-test"
p_value = t.test(.$Male, .$Female, paired = T)$p.value
}
tibble(shapiro_p = shapiro_p, test_type = test_type, p_value = p_value)
}) %>%
bind_rows() %>%
mutate(age = unique(eap_alcohol_data$age), .before = shapiro_p)
eap_alcohol_data2 = eap_alcohol_data %>%
select(year, age, sex, val) %>%
group_by(age) %>%
group_split() %>%
map(~spread(., key = "sex", value = "val")) %>%
map(~{
shapiro_p = shapiro.test(.$Male - .$Female)$p.value
if(shapiro_p < 0.05){
test_type = "Wilcoxon rank sum test"
p_value = wilcox.test(.$Male, .$Female, paired = T)$p.value
}
else{
test_type = "Student's t-test"
p_value = t.test(.$Male, .$Female, paired = T)$p.value
}
tibble(shapiro_p = shapiro_p, test_type = test_type, p_value = p_value)
}) %>%
bind_rows() %>%
mutate(age = unique(eap_alcohol_data$age), .before = shapiro_p)
kable(eap_alcohol_data2, digit = 12)
